import{r as p,Y as ae,b as se,$ as te,bW as ie,bn as le,bX as de,j as e,a_ as re,bY as ne,B as C,a$ as oe,bZ as ce,b_ as me,b$ as H,a9 as P}from"./index-W2AL0DnC.js";import{I as d}from"./index-zLdjp0Tq.js";const fe=({newProfile:s=!1})=>{var E,B;const{user:a,addUserProfile:g,updateUser:y,setRedirectToCreateProfile:A}=p.useContext(ae),[m,S]=se(),[W,X]=p.useState(""),[q,w]=p.useState(!1),j=te(),L=p.useRef(null),v=localStorage.getItem("isPvrpleAuthenticated"),f=ie(a),x=localStorage.getItem("googleUserProfile"),T=x?(E=JSON.parse(x??""))==null?void 0:E.given_name:"",I=x?(B=JSON.parse(x??""))==null?void 0:B.family_name:"",K=p.useMemo(()=>{var i,t,h,b,N;return{firstName:(a==null?void 0:a.firstName)||T,lastName:(a==null?void 0:a.lastName)||I,email:(a==null?void 0:a.email)||localStorage.getItem("isPvrpleAuthenticated"),dateOfBirth:a?le(a.dateOfBirth):void 0,referral:m.get("ref")||"",shippingAddress:{streetName:f.streetName||"",apartmentNumber:f.apartmentNumber||"",city:f.city||"",state:f.state||"",country:"USA",zipCode:f.zipCode||""},userPreference:{abandonedCartEmail:((i=a==null?void 0:a.userPreferenceValues)==null?void 0:i.abandonedCartEmail)||!1},gender:((t=a==null?void 0:a.gender)==null?void 0:t.id)||"",education:((h=a==null?void 0:a.education)==null?void 0:h.id)||"",ethnicity:((b=a==null?void 0:a.ethnicity)==null?void 0:b.id)||"",maritalStatus:((N=a==null?void 0:a.maritalStatus)==null?void 0:N.id)||""}},[a,f,T,I,m]),{data:r}=de();p.useEffect(()=>{v||j("/?auth=signin")},[v,j]);const Q=async i=>{s?g({email:localStorage.getItem("isPvrpleAuthenticated")??"",firstName:i.firstName.trim(),lastName:i.lastName.trim(),dateOfBirth:H(i.dateOfBirth),referralCode:i.referral||void 0,defaultAddress:{...i.shippingAddress,isDefaultAddress:!0,country:"USA"}}).then(()=>{w(!1),m.delete("auth"),m.delete("ref"),S(m),m.set("auth","additionalinfo"),S(m),A(!1)}).catch(()=>{P.error("An error occured while creating profile this profile",{toastId:1,type:"error"}),w(()=>{var t;return(t=L.current)==null||t.scrollIntoView({behavior:"auto",block:"center",inline:"center"}),!0})}):await y({firstName:i.firstName.trim(),lastName:i.lastName.trim(),dateOfBirth:H(i.dateOfBirth),genderId:i.gender,educationalLevelId:i.education,ethnicityId:i.ethnicity,maritalStatusId:i.maritalStatus,userPreference:i.userPreference}).then(()=>{j("/profile"),P.success("Successfully updated",{toastId:1,type:"success"})})},ee=i=>{X(i.locationId)};return e.jsx(e.Fragment,{children:v?e.jsx("div",{className:s?"m-auto flex-grow pt-5 md:flex md:h-full md:w-full md:flex-col md:justify-between md:p-0":"-mt-5 ml-60 w-2/3 flex-grow p-10 md:m-auto md:flex md:h-full md:w-full md:flex-col md:justify-between md:p-0",children:e.jsx(re,{initialValues:K,validationSchema:ne,onSubmit:Q,children:i=>{var F,O,k,z,U,R,V,D,_,Z,$,G,J,M,Y;const{handleChange:t,handleSubmit:h,isValid:b,dirty:N,setFieldValue:u,values:n,errors:c,touched:l}=i;return e.jsxs(e.Fragment,{children:[s&&q&&e.jsx("div",{ref:L,children:e.jsx("p",{className:"mb-5 font-bold text-red-500",children:"Invalid address"})}),!s&&e.jsxs("div",{className:"mb-5 flex justify-between ",children:[e.jsx("h1",{className:"text-4xl font-semibold lg:block md:hidden",children:"Edit"}),e.jsx(C,{className:"max-w-xs md:hidden",colorTheme:"purple",variant:"outline",onClick:h,type:"submit",disabled:!b,children:"Save changes"})]}),e.jsx("div",{className:"container",children:e.jsxs(oe,{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx(d,{id:"firstName",label:"First Name",name:"firstName",placeholder:"First Name*",className:"w-1/2 pr-5",fieldClass:"w-full",handleChange:t,showLabel:!s,error:c.firstName,isTouched:l.firstName}),e.jsx(d,{id:"lastName",label:"Last Name",name:"lastName",placeholder:"Last Name*",className:"w-1/2 pl-5",fieldClass:"w-full",handleChange:t,showLabel:!s,error:c.lastName,isTouched:l.lastName})]}),!s&&e.jsx(d,{label:"Email",id:"email",name:"email",fieldClass:"opacity-50",disabled:!0,handleChange:t,showLabel:!s,isTouched:l.email}),e.jsx(d,{label:"Date of birth",id:"dateOfBirth",name:"dateOfBirth",setFieldValue:u,handleChange:t,type:"datePicker",error:c.dateOfBirth,value:n.dateOfBirth,showLabel:!s,isTouched:l.dateOfBirth}),!s&&e.jsxs(e.Fragment,{children:[e.jsx(d,{label:"Gender",id:"gender",name:"gender",type:"select",setFieldValue:u,handleChange:t,value:n.gender,disabled:!r,isTouched:l.gender,options:r?(F=r.genders)==null?void 0:F.map(o=>({value:o.id,label:o.value})):[]}),e.jsx(d,{label:"Marital status",id:"maritalStatus",name:"maritalStatus",type:"select",setFieldValue:u,handleChange:t,value:n.maritalStatus,disabled:!r,isTouched:l.maritalStatus,options:r?(O=r.maritalStatuses)==null?void 0:O.map(o=>({value:o.id,label:o.value})):[]}),e.jsx(d,{label:"Ethnicity",id:"ethnicity",name:"ethnicity",type:"select",setFieldValue:u,handleChange:t,value:n.ethnicity,disabled:!r,isTouched:l.ethnicity,options:r?(k=r.ethnicities)==null?void 0:k.map(o=>({value:o.id,label:o.value})):[]}),e.jsx(d,{label:"Education level",id:"education",name:"education",type:"select",setFieldValue:u,handleChange:t,value:n.education,isTouched:l.education,disabled:!r,options:r?(z=r.educationLevels)==null?void 0:z.map(o=>({value:o.id,label:o.value})):[]}),e.jsx(d,{id:"userPreference.abandonedCartEmail",name:"userPreference.abandonedCartEmail",type:"toggle",handleChange:()=>null,setFieldValue:u,value:n.userPreference.abandonedCartEmail,label:"Email notification preference",placeholder:"Abandoned cart email"})]}),s?e.jsxs(e.Fragment,{children:[e.jsx(he,{selectedId:W}),e.jsxs("div",{children:[(U=l.shippingAddress)==null?void 0:U.streetName,e.jsx(d,{id:"shippingAddress.streetName",type:"autocomplete",name:"shippingAddress.streetName",placeholder:"Address Line 1",label:"Address Line 1",labelClass:"text-black text-base mb-2",setFieldValue:u,setSelected:ee,handleChange:t,value:n.shippingAddress.streetName,error:(R=c.shippingAddress)==null?void 0:R.streetName,showLabel:!s,isTouched:(V=l.shippingAddress)==null?void 0:V.streetName})]}),e.jsx(d,{id:"shippingAddress.apartmentNumber",name:"shippingAddress.apartmentNumber",handleChange:t,placeholder:"Address Line 2",label:"Address Line 2",showLabel:!s,isTouched:(D=l.shippingAddress)==null?void 0:D.apartmentNumber}),e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx(d,{id:"shippingAddress.city",name:"shippingAddress.city",className:"mb-0 mr-5 w-1/2",fieldClass:"w-full",placeholder:"City*",label:"City",value:n.shippingAddress.city,handleChange:t,showLabel:!s,error:(_=c.shippingAddress)==null?void 0:_.city,isTouched:(Z=l.shippingAddress)==null?void 0:Z.city}),e.jsx(d,{id:"shippingAddress.state",name:"shippingAddress.state",className:"mb-0 w-1/2",fieldClass:"w-full",placeholder:"State*",label:"State",value:n.shippingAddress.state,handleChange:t,showLabel:!s,error:($=c.shippingAddress)==null?void 0:$.state,isTouched:(G=l.shippingAddress)==null?void 0:G.state})]}),e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx(d,{className:"mb-0 mr-5 w-1/2",fieldClass:"w-full",label:"Zip Code",id:"shippingAddress.zipCode",name:"shippingAddress.zipCode",handleChange:t,showLabel:!s,placeholder:"Zip Code*",value:n.shippingAddress.zipCode,error:(J=c.shippingAddress)==null?void 0:J.zipCode,isTouched:(M=l.shippingAddress)==null?void 0:M.zipCode}),e.jsx(d,{id:"shippingAddress.country",placeholder:"USA",name:"country",label:"Country",className:"mb-0 w-1/2",fieldClass:"opacity-50 w-full",value:"USA",disabled:!0,handleChange:t,showLabel:!s,isTouched:(Y=l.shippingAddress)==null?void 0:Y.country})]}),e.jsx(d,{className:"mb-0",fieldClass:"w-full",label:"Referral code",id:"referral",name:"referral",handleChange:t,showLabel:!s,placeholder:"Referral code",value:n.referral,error:c.referral,isTouched:l.referral})]}):null,s?e.jsx("div",{className:"mt-10  w-full  self-end md:block",children:e.jsx(C,{className:"w-full max-w-full",colorTheme:"purple",variant:"filled",onClick:h,type:"submit",disabled:!(b&&N),children:"Next"})}):e.jsx("div",{className:"my-40 hidden w-full self-end pb-10 md:block",children:e.jsx(C,{className:"mt-10 w-full max-w-full",colorTheme:"purple",variant:"outline",onClick:h,type:"submit",disabled:!b,children:"Save changes"})})]})})]})}})}):e.jsx("p",{children:"not logged in"})})},he=({selectedId:s})=>{const{data:a}=ce(s),{setFieldValue:g,validateForm:y,setFieldTouched:A}=me();return p.useEffect(()=>{a!=null&&a.data&&g("shippingAddress",{streetName:a.data.label.split(",")[0],apartmentNumber:"",state:a.data.state,zipCode:a.data.zipCode,city:a.data.city})},[a,g,y,A]),null};export{fe as EditProfileDetails,fe as default};
