import{l as $,q as P,f as D,r as f,c2 as ee,j as e,V as O,a_ as te,aM as se,c3 as ae,e as j,B as w,D as N,J as ne,x as M,c4 as R,o as L,c5 as h,t as T}from"./index-W2AL0DnC.js";import{u as re,a as le}from"./MembershipAPI-D2n6KU8D.js";function ie(g){return g.map(i=>({storeId:i.store.id,configuration:oe(i.fields)}))}function oe(g){const i={};return g.forEach(c=>{c.id&&c.value!==null&&(i[c.id]=c.value)}),i}const me=({displayType:g=N.collapsable,automaticallyUpdate:i,onSubmit:c,isSidePanel:n,jobConfigData:p,isStarting:z,closePanel:A})=>{const{carts:y}=$(),{setCurrentConfig:b,setStatus:_,isPending:F,status:U}=P(),{refetch:q,data:a,isFetching:S}=re(),{mutateAsync:C}=le(),v=D("(max-width: 639px)"),[H,J]=f.useState({}),[Q,W]=f.useState([]),[G,E]=f.useState(!1),[K,V]=f.useState(p??{}),u=ee(Q,500),B=s=>{const r={};return s.forEach(o=>{o.fields.forEach(l=>{r[l.id.toString()]=l.fieldType===h.BOOLEAN?l.value==="true":l.value||"0"})}),r};f.useEffect(()=>{(a!=null&&a.data||p)&&V(B(p??a.data))},[a,V,p]),f.useEffect(()=>(u&&u.length>0&&i&&C({storeConfig:u}).then(()=>{}).catch(()=>{}),b({storeConfig:u}),()=>{b({storeConfig:[]})}),[u,C,i,b]);const X=s=>{J(r=>({...r,[s]:!r[s]}))},k=()=>{C({storeConfig:u}).then(()=>{n||T("Membership settings saved","success",1)}).catch(()=>{n||T("Failed to save membership settings. Try again","error",1)})},I=s=>{switch(s.fieldType){case h.BOOLEAN:return{type:h.BOOLEAN,field:s.id.toString(),toggleState:H[s.id]||s.value,handleToggle:X,label:s.displayText,classnames:"mb-5 flex justify-between flex-row text-base"};case h.POSITIVE_NUMBER:return{type:h.POSITIVE_NUMBER,field:s.id.toString(),label:s.displayText,classnames:"mb-5 flex flex-row justify-between text-base items-center",inputClassnames:"flex flex-row rounded-md border border-black-100 text-base max-w-[5rem]"};default:return null}};if(!a)return e.jsx("div",{className:"m-28",children:e.jsx(O,{size:45})});const Y=s=>{const r=a==null?void 0:a.data.map(o=>{const l={};return o.fields.forEach(d=>{const m=s[d.id.toString()];m!==void 0&&(l[d.id.toString()]=m.toString()),!m&&typeof m=="string"&&(l[d.id.toString()]="0")}),{storeId:o.store.id,configuration:l}});W(r)};return e.jsx(te,{enableReinitialize:!0,initialValues:K,onSubmit:k,initialTouched:!0,children:s=>{const{handleChange:r,values:o,setValues:l,setFieldValue:d}=s,m=t=>{r(t),Y({...o,[t.target.name]:t.target.value??"0"})},Z=async()=>{E(!0);try{const t=await q();if(t.data){l(B(t==null?void 0:t.data.data));const x=ie(t.data.data);b({storeConfig:x??[]})}}catch{T("Something went wrong. Please try again","error",3)}finally{E(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(se,{loading:z}),S?e.jsx("div",{className:"m-28",children:e.jsx(O,{size:45})}):e.jsxs(ae,{onSubmit:t=>{t.preventDefault(),c?c({storeConfig:u}):k()},className:j({"flex h-full w-1/2 flex-col lg:w-full sm:pb-5":!n,"relative flex h-full w-full flex-col sm:p-5":n}),children:[n&&e.jsxs("div",{className:"mb-5",children:[e.jsx(w,{variant:"outline",colorTheme:"purple",className:"w-fit self-end text-sm",onClick:()=>void Z(),disabled:G,children:"Reset Membership Information"}),e.jsx("p",{className:"mt-2 text-sm font-medium",children:"Personalize your savings by updating your membership information in each of the below stores."})]}),!S&&{[N.collapsable]:e.jsx("div",{className:"flex flex-col overflow-auto",children:a==null?void 0:a.data.map(t=>e.jsx(ne,{className:j("mb-5 bg-white-100",n&&"border-opacity-50 bg-purple-500 font-thin"),title:e.jsx("div",{className:"w-16",children:e.jsx(M,{store:t.store.name},t.store.id)},t.store.id),content:e.jsx("div",{className:"max-w-full",children:e.jsx(R,{config:t.fields.map(I).filter(x=>x!==null),handleChange:m,formik:{handleChange:r,values:o,setFieldValue:d}})},t.store.id)},t.store.id))}),[N.vertical]:e.jsx(e.Fragment,{children:a==null?void 0:a.data.map(t=>e.jsxs("div",{className:"w-16",children:[e.jsx(M,{store:t.store.name},t.store.id),e.jsx("div",{className:"max-w-lg ",children:e.jsx(R,{config:t.fields.map(I).filter(x=>x!==null),handleChange:m,formik:{handleChange:r,values:o,setFieldValue:d}})},t.store.id)]},t.store.id))})}[g],e.jsx("div",{className:j({"flex flex-col justify-center":!v,"mb-1 flex w-full flex-row justify-center":v}),children:(v||!n)&&e.jsxs("div",{className:j({"flex flex-col items-end self-end":!n,"flex w-full flex-col items-center self-center":v}),children:[!n&&e.jsx(w,{className:"my-5 w-full px-10",variant:"filled",colorTheme:"purple",type:"submit",children:"Save"}),n&&e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"my-5 w-min px-10 sm:w-full",variant:"filled",colorTheme:"purple",type:"submit",disabled:y.length<1||F,"aria-disabled":y.length<1||F,children:"Calculate"}),e.jsx(w,{colorTheme:"purple",variant:"outline",className:"w-full whitespace-nowrap px-10",onClick:A,children:"Back To Cart"}),y.length<1&&e.jsx("p",{className:"text-xs text-red-500",children:"To activate smart saving, you must have at least one cart."})]}),U==L.success&&n&&e.jsx("a",{className:"mb-5 text-sm text-purple-500 hover:cursor-pointer hover:underline",onClick:()=>{_(L.toggled)},children:"Back to suggestions"})]})})]})]})}})};export{me as S};
