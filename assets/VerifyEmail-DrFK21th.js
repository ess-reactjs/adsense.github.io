import{r as l,b as P,Y as E,$ as I,bA as M,l as A,c as F,j as e,a_ as U,a$ as V,bM as Y,V as k,bD as g,a9 as z,bE as p}from"./index-W2AL0DnC.js";const L=({email:d,password:b,resendVerification:j})=>{const[m,c]=l.useState(null),[u,n]=l.useState(!1),[t,h]=P(),[o,y]=l.useState(""),{setUser:S}=l.useContext(E),r=I(),{refetch:w}=M(),{refetchCarts:f}=A(),{refetch:v}=F(),N=async s=>{try{if(n(!0),await g.confirmSignUp(d,s.code),n(!1),y("Your email has been successfully verified!"),t.get("email"))return z("Your email has been successfully verified. Please log in to continue."),r("/signin");await C({email:d,password:b})}catch(i){c(i.message),n(!1)}},C=async s=>{var i,x;n(!0);try{await g.signIn(s.email,s.password);const a=await v();(i=a.data)!=null&&i.isSuccess?(await w(),f(),p(),t.delete("auth"),t.get("email")&&t.delete("email"),h(t),localStorage.setItem("isPvrpleAuthenticated",s.email),(x=a.data)!=null&&x.data?(S(a.data.data),setTimeout(()=>{a.data.data&&(f(),r("/signup/auth-profile?email="+s.email))},200)):r("/signup/auth-profile?email="+s.email),r("/signup/auth-profile?email="+s.email)):c(null)}catch(a){a.code==="UserNotConfirmedException"&&(t.set("auth","verifyemail"),t.set("email",s.email),h(t)),p(),c(a.message)}finally{n(!1)}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"verification_modal relative ",children:[e.jsx("h3",{className:"fw-500 mb-4 text-center",children:"Email Verification "}),e.jsx("p",{className:"fw-400 text-center",children:"Please enter the 6 digit code that is sent to your email"}),e.jsx(U,{initialValues:{code:""},onSubmit:N,children:s=>e.jsxs(V,{children:[e.jsx("div",{className:"",children:e.jsx(Y,{value:s.values.code,valueLength:6,onChange:i=>{s.handleChange("code")(i)}})}),m&&e.jsx("div",{className:"mt-1 text-sm text-red-500",children:m}),o&&e.jsx("div",{className:"mt-2 px-2 text-center text-sm text-green-500",children:o}),u&&e.jsx("div",{className:"bg-white absolute inset-0 z-50 flex items-center justify-center bg-white-500 bg-opacity-50",children:e.jsx(k,{size:40})}),e.jsx("button",{className:" mb-4 w-full rounded-lg bg-purple-500 py-4 font-bold text-white-500 hover:bg-purple-600",type:"submit",disabled:u||o.length>0,children:"Continue"}),e.jsxs("div",{className:" flex w-full justify-center text-sm",children:[e.jsx("span",{className:"fw-500  pr-1 text-center",children:"Didn't receive the code?"}),e.jsx("button",{onClick:j,className:"fw-500 resend-btn ",type:"button",children:"Resend"})]})]})})]})})};export{L as default};
