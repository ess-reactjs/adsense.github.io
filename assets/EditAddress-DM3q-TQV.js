import{bT as T,r as c,Y as E,bU as ee,ad as se,bs as ae,bt as N,bZ as le,c0 as te,c1 as re,$ as ie,j as e,bQ as ce,V as me,a_ as de,bv as m,B as z,aj as ne,a9 as p,v as q,bz as oe}from"./index-W2AL0DnC.js";const he=({isNewAddress:x})=>{const{data:A,refetch:y,isFetching:D}=T(!x),{user:t,updateDefaultAddress:F}=c.useContext(E),P=ee(),[S,I]=c.useState(!1),{addressId:f}=se(),s=A==null?void 0:A.data.userAddresses.find(l=>l.id===f),[B,M]=c.useState(!1),[j,R]=c.useState(s==null?void 0:s.isDefaultAddress),w=c.useMemo(()=>({city:(s==null?void 0:s.city)||"",state:(s==null?void 0:s.state)||"",country:(s==null?void 0:s.country)||"USA",zipCode:(s==null?void 0:s.zipCode)||"",placeId:(s==null?void 0:s.id)||"",streetName:(s==null?void 0:s.streetName)||"",isDefaultAddress:(s==null?void 0:s.isDefaultAddress)||!1,apartmentNumber:(s==null?void 0:s.apartmentNumber)||"",firstName:(s==null?void 0:s.firstName)||(t==null?void 0:t.firstName)||"",lastName:(s==null?void 0:s.lastName)||(t==null?void 0:t.lastName)||"",email:s&&s.email?decodeURIComponent(s.email).trim():t&&t.email?decodeURIComponent(t==null?void 0:t.email).trim():"",phoneNumber:(s==null?void 0:s.phoneNumber)||(t==null?void 0:t.phoneNumber)||""}),[s,t]),O=ae().shape({streetName:N().trim().required("Address Line 1 is required"),state:N().trim().required("State is required"),city:N().trim().required("City is required"),zipCode:N().trim().required("Zip Code is required").matches(/^[0-9]+$/,"Must be only digits").min(5,"Must be exactly 5 digits").max(5,"Must be exactly 5 digits"),placeId:N(),firstName:N().trim().required("First Name is required"),lastName:N().trim().required("Last Name is required"),email:N().trim().email("Email is invalid").required("Email is required")}),V=localStorage.getItem("isPvrpleAuthenticated"),[_,Z]=c.useState({}),[$,b]=c.useState(w),[Y,k]=c.useState(!1),{data:r,isLoading:U}=le(_.locationId),G=te(),H=re(),g=ie();V||g("/"),c.useEffect(()=>{b(w)},[w]);const Q=l=>{Z(()=>l)},J=l=>{I(!0),x?H.mutateAsync(l).then(a=>{var n;y();const d=(n=a==null?void 0:a.data)==null?void 0:n.userAddress.id;d&&j&&F(d,{...l,id:d}),p.success("Successfully added",{toastId:1,type:"success"}),g(q.address_book)}).catch(a=>{p.error(a.response.data.Error.Message,{toastId:2,type:"error"})}).finally(()=>{I(!1)}):G.mutateAsync({address:l,id:f}).then(()=>{y(),f&&j&&F(f,{...l,id:f}),p.success("Successfully updated",{toastId:1,type:"success"}),g(q.address_book)}).catch(a=>{p.error(a.response.data.Error.Message,{toastId:2,type:"error"})}).finally(()=>{I(!1)})},K=l=>{k(!1),M(!0),P.mutateAsync(l).then(()=>{y(),p.success("Successfully deleted",{toastId:1,type:"success"}),g(q.address_book)}).catch(()=>{y(),p.error("Something went wrong",{toastId:2,type:"error"})}).finally(()=>{M(!1)})};return c.useEffect(()=>{r&&!U&&b(l=>{var a,d,n;return{...l,zipCode:((a=r==null?void 0:r.data)==null?void 0:a.zipCode)||"",state:((d=r==null?void 0:r.data)==null?void 0:d.state)||"",city:((n=r==null?void 0:r.data)==null?void 0:n.city)||"",streetName:(r==null?void 0:r.data.label.split(",")[0])||"",placeId:_.locationId||"",country:"USA"}})},[r,U,_]),e.jsxs(ce,{className:"mb-20",title:x?"Add New Address":"Edit Address",children:[D?e.jsx("div",{className:"m-28",children:e.jsx(me,{size:45})}):e.jsx(de,{initialValues:$||w,onSubmit:l=>{b(l),J(l)},enableReinitialize:!0,validationSchema:O,validateOnChange:!1,validateOnBlur:!0,children:l=>{const{handleChange:a,handleSubmit:d,setFieldValue:n,values:i,errors:o,touched:u}=l,C=h=>{if(a(h),h.target.name==="phoneNumber")return W(h);const{name:v,value:L}=h.target;b(X=>({...X,[v]:L}))},W=h=>{const v=oe(h.target.value);n("phoneNumber",v),b(L=>({...L,phoneNumber:v}))};return e.jsxs("div",{children:[e.jsxs("div",{className:" mt-10 flex flex-row justify-between sm:block",children:[e.jsxs("div",{className:"mr-5 w-1/2 sm:w-full",children:[e.jsxs("label",{className:"fw-400 gray_color mb-2",children:["First Name ",e.jsx("span",{className:"red_color",children:"*"})]}),e.jsx(m,{id:"firstName",placeholder:"First Name",name:"firstName",className:" mb-0 rounded-xl",fieldClass:"w-full capitalize",handleChange:C,error:o.firstName,value:i.firstName,isTouched:u.firstName})]}),e.jsxs("div",{className:"w-1/2 sm:w-full ",children:[e.jsxs("label",{className:"fw-400 gray_color mb-2 sm:mt-5",children:["Last Name ",e.jsx("span",{className:"red_color",children:"*"})]}),e.jsx(m,{id:"lastName",className:" ",fieldClass:"w-full capitalize",placeholder:"Last Name",name:"lastName",handleChange:C,value:i.lastName,error:o.lastName,isTouched:u.lastName})]})]}),e.jsxs("div",{className:" flex flex-row justify-between sm:block",children:[e.jsxs("div",{className:"mr-5 w-1/2 sm:w-full",children:[e.jsxs("label",{className:"fw-400 gray_color mb-2 mt-5",children:["Email ",e.jsx("span",{className:"red_color",children:"*"})]}),e.jsx(m,{id:"email",placeholder:"Email",name:"email",className:" mb-0 ",fieldClass:"w-full",handleChange:C,value:decodeURIComponent(i.email).trim(),error:o.email,isTouched:u.email})]}),e.jsxs("div",{className:"w-1/2 sm:w-full",children:[e.jsx("label",{className:"fw-400 gray_color mb-2 mt-5",children:"Phone Number"}),e.jsx(m,{id:"phoneNumber",className:" ",fieldClass:"w-full",placeholder:"Phone Number",name:"phoneNumber",value:i.phoneNumber,handleChange:C,error:o.phoneNumber,isTouched:u.phoneNumber})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"fw-400 gray_color mb-2 mt-5",children:["Address Line 1 ",e.jsx("span",{className:"red_color",children:"*"}),"Â ",e.jsx("span",{className:"text-base",children:"(Please select address from the suggestions list)"})]}),e.jsx(m,{type:"autocomplete",id:"streetName",name:"streetName",className:"",value:i.streetName,setFieldValue:n,setSelected:Q,handleChange:a,placeholder:"Address Line 1 ",error:o.streetName,isTouched:u.streetName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"fw-400 gray_color mb-2 mt-5",children:"Address Line 2"}),e.jsx(m,{id:"apartmentNumber",name:"apartmentNumber",value:i.apartmentNumber,setFieldValue:n,handleChange:a,className:" ",placeholder:"Address Line 2 "})]}),e.jsxs("div",{className:"my-5 mb-0 flex flex-row justify-between sm:block",children:[e.jsxs("div",{className:"mr-5 w-1/2 sm:w-full",children:[e.jsxs("label",{className:"fw-400 gray_color mb-2",children:["City ",e.jsx("span",{className:"red_color",children:"*"})]}),e.jsx(m,{id:"city",placeholder:"City*",name:"city",className:" mb-0 ",fieldClass:"w-full",handleChange:a,error:o.city,isTouched:u.city})]}),e.jsxs("div",{className:"w-1/2 sm:w-full",children:[e.jsxs("label",{className:"fw-400 gray_color mb-2 sm:mt-5",children:["State ",e.jsx("span",{className:"red_color",children:"*"})]}),e.jsx(m,{id:"state",className:" ",fieldClass:"w-full",placeholder:"State*",name:"state",value:i.state,handleChange:a,error:o.state,isTouched:u.state})]})]}),e.jsxs("div",{className:" flex flex-row justify-between sm:block",children:[e.jsxs("div",{className:"mr-5 w-1/2 sm:w-full",children:[e.jsxs("label",{className:"fw-400 gray_color mb-2 mt-5",children:["Zip Code ",e.jsx("span",{className:"red_color",children:"*"})]}),e.jsx(m,{className:" mb-0 ",fieldClass:"w-full",id:"zipCode",name:"zipCode",handleChange:a,placeholder:"Zip Code",value:i.zipCode,error:o.zipCode,isTouched:u.zipCode,maxLength:5,type:"number"})]}),e.jsxs("div",{className:" w-1/2 sm:w-full",children:[e.jsxs("label",{className:"fw-400 gray_color mb-2 mt-5",children:["Country ",e.jsx("span",{className:"red_color",children:"*"})]}),e.jsx(m,{id:"shippingAddress.country",placeholder:"Country",name:"country",className:" ",value:i.country,disabled:!0,fieldClass:"opacity-50",handleChange:a})]})]}),e.jsxs("div",{className:" mb-5 mt-5",children:[e.jsx("input",{type:"checkbox",id:"termsCheckbox",className:"checkbox-input",checked:j,onChange:h=>R(h.target.checked)}),e.jsx("label",{htmlFor:"termsCheckbox",className:"checkbox-label",children:"Make this your default address"})]}),e.jsx("div",{className:"pt-4",children:x?e.jsx(z,{className:"theme-btn bg_primary w-auto max-w-40",type:"submit",variant:"filled",disabled:S,onClick:d,children:"Save"}):e.jsxs("div",{className:"flex w-1/2 sm:w-full",children:[e.jsx(z,{className:"mr-5  w-3/12 sm:w-6/12 ",colorTheme:"purple",type:"button",variant:"filled",disabled:S,onClick:d,children:"Update"}),e.jsx(z,{className:" delete-btn w-3/12 sm:w-6/12",colorTheme:"purple",type:"button",variant:"outline",disabled:D||i.isDefaultAddress||j||S||B,onClick:()=>k(!0),children:"Delete"})]})})]})}}),f&&Y&&e.jsx(ne,{message:"Are you certain you want to delete this address from your account?",title:"Delete Your Address",type:"action",confirmBtnText:"Delete",cancelBtnText:"No",confirm:()=>{K(f)},dismiss:()=>{k(!1)}})]})};export{he as EditAddress,he as default};
