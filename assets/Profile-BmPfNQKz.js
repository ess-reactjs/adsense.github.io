import{j as e,r as l,Y,bp as z,bq as q,$ as R,bk as V,bl as W,br as Q,bs as G,bt as C,bu as K,ai as H,B as w,a1 as J,a_ as X,a$ as Z,bv as d,bw as ee,bx as ae,t as x,by as te,a9 as se,bz as le}from"./index-W2AL0DnC.js";const ie=({text:a})=>e.jsx("div",{className:" flex  w-fit justify-center rounded-md bg-[#FFF5FD] p-2 md:w-full md:justify-start",children:e.jsx("p",{className:"text-black text-sm",children:a})}),re=9;function oe(){var g;const{user:a,updateUserV2:D}=l.useContext(Y),{data:i}=z(),{mutateAsync:S}=q(),[f,j]=l.useState(i==null?void 0:i.data),[v,A]=l.useState(0),[p,B]=l.useState(!0),[y,k]=l.useState(0),N=R(),[O,h]=l.useState(!1),F=V(),M=W({onSuccess:()=>{localStorage.removeItem("isPvrpleAuthenticated"),window.location.pathname="/",window.location.search=""}});l.useEffect(()=>{a||N("/signin")},[a,N]);const T=async t=>{try{await S(ae({initialFormValues:t})),j(t),x("Thank you! We have saved your information","success",1)}catch(s){console.error("Error submitting form",s),x("Something went wrong. Try again","error",1)}};l.useEffect(()=>{j(i==null?void 0:i.data)},[i]),l.useEffect(()=>{let t=0;f==null||f.forEach(s=>{s!=null&&s.answers&&s.answers.find(n=>n.isSelected===!0&&n.userInput!=="0")&&t++}),A(t)},[f]),l.useEffect(()=>{let t=0;a!=null&&a.firstName&&t++,a!=null&&a.lastName&&t++,a!=null&&a.email&&t++,a!=null&&a.phoneNumber&&t++,a!=null&&a.dateOfBirth&&t++,t+=v;const s=Math.floor(t/re*100);k(s)},[a,v]);const P=async()=>{await F.mutateAsync().then(()=>{M.mutate(),N("/"),x("Successfully deleted your account","success",2)}).catch(()=>{x("There was a problem deleting your account. Please try again.","error",2)}).finally(()=>{h(!1)})},_=()=>{P()},E=async t=>{await D({firstName:t.firstName.trim(),lastName:t.lastName.trim(),dateOfBirth:te(t.dateOfBirth),phoneNumber:t.phoneNumber.trim()}).then(()=>{se.success("Successfully updated",{toastId:1,type:"success"})})},I={email:decodeURIComponent((a==null?void 0:a.email)||"")||"",firstName:(a==null?void 0:a.firstName)||"",lastName:(a==null?void 0:a.lastName)||"",dateOfBirth:a!=null&&a.dateOfBirth?Q(a.dateOfBirth):"",phoneNumber:(a==null?void 0:a.phoneNumber)||""},U=G({firstName:C().trim().required("First Name is required"),email:C().trim().email("Invalid email").required("Email is required"),dateOfBirth:K().required("Date of birth is required").test("is-20-years-old","You must be at least 18 years old",function(t){const s=new Date,r=new Date(t),n=s.getFullYear()-r.getFullYear(),o=s.getMonth()-r.getMonth();return o<0||o===0&&s.getDate()<r.getDate()?n-1>=18:n>=18})});return e.jsxs(e.Fragment,{children:[e.jsxs(H,{modalWidth:"500px",shouldShow:O,onClose:()=>h(!1),shouldClose:!0,className:"w-[200px] p-10 md:w-[60%] sm:w-[80%] sm:px-5",textColor:"text-purple-500 ",children:[e.jsx("div",{className:"mr-2 text-center text-2xl font-semibold",children:"Delete Your Account"}),e.jsx("div",{className:"gray_color mb-10 mt-5 text-center text-lg",children:"Deleting your account will permanently erase all your information from our database. This action cannot be reversed."}),e.jsxs("div",{className:"mx-auto mt-5 flex w-9/12 flex-row justify-center gap-3 md:w-11/12 sm:w-full",children:[e.jsx(w,{colorTheme:"red",variant:"bare",onClick:_,className:"delete-btn ",children:"Delete"}),e.jsx(w,{colorTheme:"purple",variant:"filled",onClick:()=>{h(!1)},children:"Keep Account"})]})]}),a?e.jsxs("div",{className:"ml-410 ml-410 mb-20 md:m-auto",children:[e.jsxs("div",{className:"mb-16 flex sm:block",children:[e.jsx("div",{className:"w-6/12 sm:mb-10 sm:w-full",children:e.jsxs("div",{className:"group relative",children:[e.jsx("h1",{className:"fw-500 fw-400 mb-10 mb-3 block text-left text-2xl",children:"My Profile"}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"avatar-circular fw-500 relative mt-10 flex items-center justify-center",children:[(g=a==null?void 0:a.firstName)==null?void 0:g.charAt(0).toUpperCase(),a.createdAt&&e.jsx("div",{className:"right-200 membership_since absolute bottom-0 ",children:e.jsx(ie,{text:`Member since ${J(new Date(a.createdAt),"MMMM dd, yyyy")}`})})]})})]})}),e.jsx("div",{className:"w-6/12 sm:mb-10 sm:w-full",children:e.jsxs("div",{className:"profile-completion",children:[e.jsxs("div",{className:"mb-5 flex items-center justify-between",children:[e.jsx("h6",{className:"fw-500 text-purple-500",children:"Profile Completion"}),e.jsxs("div",{className:"user_percentage text-md fw-500 flex items-center justify-center",children:[y,"%"]})]}),e.jsx("div",{className:"mb-4 h-2 w-full overflow-hidden rounded-md bg-white-100",children:e.jsx("div",{style:{width:`${y}%`,transition:"width 0.3s ease-in-out"},className:"progress_bar h-full"})}),e.jsx("p",{className:"text-sm text-black-500",children:"Complete your profile now for a more personalized experience."})]})})]}),e.jsx(X,{initialValues:I,validationSchema:U,onSubmit:E,validateOnMount:!1,children:({handleChange:t,handleSubmit:s,isValid:r,dirty:n,setFieldValue:o,errors:c,touched:m,values:u})=>{const $=b=>{const L=le(b.target.value);o("phoneNumber",L)};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"container",children:e.jsxs(Z,{onSubmit:s,className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-row justify-between sm:flex-col sm:gap-y-5",children:[e.jsxs("div",{className:"mr-5 w-full flex-1",children:[e.jsx("label",{className:"fw-400 gray_color mb-2",children:"First Name"}),e.jsx(d,{id:"firstName",name:"firstName",placeholder:"First Name",fieldClass:"w-full capitalize",handleChange:t,error:c.firstName,isTouched:m.firstName})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"fw-400 gray_color mb-2",children:"Last Name"}),e.jsx(d,{id:"lastName",name:"lastName",placeholder:"Last Name",fieldClass:"w-full capitalize",handleChange:t,value:u.lastName,error:c.lastName,isTouched:m.lastName})]})]}),e.jsxs("div",{className:"flex flex-row justify-between sm:flex-col sm:gap-y-5",children:[e.jsxs("div",{className:"mr-5 w-full flex-1",children:[e.jsx("label",{className:"fw-400 gray_color mb-2",children:"Phone Number"}),e.jsx(d,{id:"phoneNumber",name:"phoneNumber",value:u.phoneNumber,placeholder:"Phone Number",fieldClass:"w-full",handleChange:$,error:c.phoneNumber,isTouched:m.phoneNumber})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"fw-400 gray_color mb-2",children:"Date of Birth"}),e.jsx("div",{className:"relative",children:e.jsx(d,{id:"dateOfBirth",name:"dateOfBirth",type:"datePicker",setFieldValue:o,handleChange:b=>void o("dateOfBirth",b.target.value),value:u.dateOfBirth,error:c.dateOfBirth,isTouched:m.dateOfBirth})})]})]}),e.jsxs("div",{style:{marginTop:0},children:[e.jsx("label",{className:"fw-400 gray_color mb-2 mt-3",children:"Email"}),e.jsx(d,{id:"email",name:"email",fieldClass:"opacity-50 cursor-not-allowed",disabled:!0,value:decodeURIComponent(u.email),handleChange:t,error:c.email,isTouched:m.email})]}),e.jsx("div",{className:"my-40 w-3/12 self-end pb-10 md:block",children:e.jsx(w,{className:"mt-10 w-full max-w-[200px]",colorTheme:"purple",variant:"filled",type:"submit",disabled:!r||!n,children:"Save"})})]})})})}}),e.jsx("hr",{className:"hr  mt-2"}),e.jsx("div",{className:"mx-auto  w-full max-w-full",children:e.jsxs("div",{className:"",children:[e.jsxs("button",{onClick:()=>B(!p),className:"flex w-full items-center justify-between transition duration-300 ease-in-out",children:[e.jsx("span",{className:" font-semibold",children:"Additional Questions"}),e.jsx("svg",{className:`h-6 w-6 transition-transform duration-300 ${p?"rotate-180 transform":""}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),p&&e.jsx("div",{className:"mt-10 w-full max-w-[524px] md:w-full",children:e.jsx(ee,{handleSubmit:T,isProfile:!0})})]})}),e.jsx("div",{className:"delete_profile pt-10",children:e.jsx("p",{className:"fw-500 text-md inline cursor-pointer underline hover:underline",onClick:()=>h(!0),children:"Delete your account"})})]}):null]})}export{oe as default};
