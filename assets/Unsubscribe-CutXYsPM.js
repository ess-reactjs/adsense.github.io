import{c9 as w,aR as v,bS as N,r as x,Y as P,b as E,$ as S,j as e,V as k}from"./index-W2AL0DnC.js";const C=()=>{let s;const c=new Promise((n,i)=>{s=(r,l)=>{r&&i(r),n(l)}});return s.promise=c,s},A=N,M=async(s,c)=>{var i;const n=C();try{const r=await A.put(v.unsubscribe,s,{withCredentials:!0,signal:c});n(null,r.data)}catch(r){n(((i=r==null?void 0:r.response)==null?void 0:i.data)||r)}return n.promise},U=s=>w(["unsubscribeEmailPreference"],c=>M(c),s),F=[{Heading:"Abandoned cart emails",label:"If you unsubscribe, you will stop receiving your abandoned cart emails.",id:"1",key:"abandonedCartEmail"}],I=()=>{const{user:s,getUser:c}=x.useContext(P),[n,i]=x.useState(""),[r]=E(),l=S(),{mutateAsync:f,isLoading:h,isError:b,isSuccess:g}=U({retry:3,retryDelay:t=>Math.pow(2,t)}),m=r.get("id")||"",o=(()=>{try{return m&&atob(m)}catch{return"---"}})(),y=r.get("sig")||"",j=()=>{f({sig:y,id:m,userPreference:F.reduce((t,a)=>({...t,[a.key]:!1}),{})}).then(async t=>{var a,d,p;t.isSuccess&&s!=null&&s.email&&((d=(a=s==null?void 0:s.email)==null?void 0:a.toLowerCase)==null?void 0:d.call(a))===((p=o.toLowerCase)==null?void 0:p.call(o))&&await c()}).catch(t=>{var a;return i(((a=t==null?void 0:t.Error)==null?void 0:a.Message)||"Oops! Something went wrong.")})};x.useEffect(()=>{j()},[]);const u=x.useMemo(()=>e.jsx("div",{className:" pt-5 text-xl ",children:e.jsxs("p",{className:"dark-color flex items-center justify-center gap-1",children:["Manage your email preferences"," ",e.jsx("span",{onClick:()=>l("/edit"),className:"text_primary cursor-pointer font-medium",children:"here"})]})}),[l]);return e.jsx("div",{className:"flex min-h-80 items-center justify-center",children:h?e.jsx(k,{size:84}):e.jsx("div",{className:"flex w-full max-w-3xl grow flex-col  rounded-lg border-2 border-black-100 p-5 shadow-md",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:" flex flex-col gap-5 py-7 ",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-1",children:[e.jsx("h2",{className:"text_primary text-3xl",children:"Unsubscribe"}),e.jsx("p",{children:"You have successfully unsubscribed."}),e.jsx("h2",{className:"max-w-full break-words text-center text-2xl text-purple-300",children:o}),e.jsx("div",{className:"font-medium",children:"has been removed from our mailing list."})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-white -mx-5 bg-purple-300 py-5 text-center  text-xl uppercase",children:"Thank You"}),u]})]}):e.jsxs("div",{className:" flex flex-col gap-7 py-2 text-purple-300 ",children:[e.jsx("div",{className:"py-3 text-center text-2xl",children:b?n:"Oops! Something went wrong"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-white -mx-5 bg-purple-300 py-4 text-center uppercase",children:"Try Again Later"}),u]})]})})})};export{I as default};
