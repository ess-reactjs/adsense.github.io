import{bs as v,bt as d,bI as I,b as A,r as n,j as e,L as T,v as z,a_ as F,a$ as k,bB as p,bC as u,m as B,bJ as $,V as _,bD as c,t as w,bF as y,bG as q,bK as O}from"./index-W2AL0DnC.js";import{G as R}from"./index-D10kJhc4.js";const U=v().shape({newEmail:d().email("Invalid email").required("Please fill in your email"),newPassword:d().required("Please fill in your password").min(8,"Password must be at least 8 characters").matches(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*]).*$/,"Password must contain at least one uppercase letter, one lowercase letter, one number, and one special character (!@#$%^&*)"),newPasswordConfirmation:d().oneOf([I("newPassword")],"Passwords must match").required("Password confirmation is required")}),W=()=>{const[t,o]=A(),[l,P]=n.useState(!1),[x,E]=n.useState(!1),[h,m]=n.useState(!1),[j,f]=n.useState(!1),S=()=>{P(!l)},b=async()=>(document.body.style.cursor="wait",document.getElementById("modalOverlay").style.display="block",document.getElementById("modal").style.display="block",new Promise((s,a)=>{window.AwsWafCaptcha.renderCaptcha(document.getElementById("captchaForm"),{onSuccess:r=>{document.getElementById("modalOverlay").style.display="none",document.getElementById("modal").style.display="none",s(r)},onLoad:()=>{document.body.style.cursor="default"},onError:()=>{a("Captcha Error")},onPuzzleTimeout:()=>{},onPuzzleIncorrect:()=>{},onPuzzleCorrect:()=>{},apiKey:O().CAPTCHA_API_KEY})})),N=s=>{const{status:a,headers:r}=s.response;return a===405&&r["x-amzn-waf-action"]==="captcha"},C=async s=>{try{m(!0),await c.signUp(s.newEmail,s.newPassword).catch(async r=>{const g=await b();if(typeof g=="string"&&await c.confirmSignIn(s.newEmail,g),N(r)){w("Captcha required","error",2);try{const i=await b();i&&typeof i=="string"&&await c.confirmSignIn(s.newEmail,i)}catch{w("Error rendering captcha:","error",2)}}else w(`general error ${r}`,"error",1)}),t.set("auth","verifyemail"),t.set("email",s.newEmail),m(!1),o(t);const a=t.get(y.ExternalPortalUrl);a!==null&&(q(a),t.delete(y.ExternalPortalUrl))}catch(a){E(a.message),m(!1),await c.confirmSignIn(s.newEmail,"12345","SOFTWARE_TOKEN_MFA")}};return n.useEffect(()=>{localStorage.getItem("isPvrpleAuthenticated")&&t.set("auth","profile"),o(t)},[t,o]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative pb-4",children:[e.jsx("h1",{className:"mb-1 text-4xl font-bold text-purple-500",children:"Sign up"}),e.jsxs("p",{className:"mb-8 mt-4 text-xs",children:["By signing up you agree to our",e.jsx(T,{to:z.terms,target:"_blank",className:"text mx-1 underline hover:text-purple-500",children:"Terms and Conditions."})]}),e.jsx(R,{}),e.jsx(F,{initialValues:{newEmail:"",newPassword:"",newPasswordConfirmation:""},validationSchema:U,onSubmit:C,children:({errors:s})=>e.jsxs(k,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(p,{autoComplete:"new-email",className:"w-full rounded-lg border border-white-500 px-3 py-4 text-sm",type:"email",name:"newEmail",placeholder:"Email"}),e.jsx(u,{name:"newEmail",component:"div",className:"mt-1 px-2 text-sm text-red-500"}),x&&!s.newEmail&&e.jsx("div",{className:"ml-2 mt-1 text-sm text-red-500",children:x})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(B,{label:$,placement:"top-end",showTooltip:j,children:e.jsxs("div",{className:"relative",children:[e.jsx(p,{autoComplete:"new-password",className:"w-full rounded-lg border border-white-500 px-3 py-4 text-sm",type:l?"text":"password",name:"newPassword",placeholder:"Password",onFocus:()=>f(!0),onBlur:()=>f(!1)}),e.jsx("button",{type:"button",className:"absolute  right-3 top-1/2 -translate-y-1/2 transform text-sm text-purple-500",onClick:S,children:l?"Hide":"Show"})]})},1),e.jsx(u,{name:"newPassword",component:"div",className:"mt-1 px-2 text-sm text-red-500"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(p,{autoComplete:"new-password-confirmation",className:"w-full rounded-lg border border-white-500 px-3 py-4 text-sm",type:l?"text":"password",name:"newPasswordConfirmation",placeholder:"Confirm Password"}),e.jsx(u,{name:"newPasswordConfirmation",component:"div",className:"mt-1 px-2 text-sm text-red-500"})]}),h&&e.jsx("div",{className:"bg-white absolute inset-0 z-50 flex items-center justify-center bg-white-500 bg-opacity-50",children:e.jsx(_,{size:40})}),e.jsx("button",{className:"my-4 w-full rounded-lg bg-purple-500 py-4 text-sm font-bold text-white-500 hover:bg-purple-600",type:"submit",disabled:h,children:"Sign up"})]})}),e.jsxs("div",{className:" flex w-full justify-center text-sm",children:[e.jsx("span",{className:"pr-1 text-center",children:"Already have an account? "}),e.jsx("button",{onClick:()=>{t.set("auth","signin"),o(t)},className:" font-bold text-green-500 underline hover:text-green-600",children:"Sign in here"})]})]})})};export{W as default};
