import{bT as V,r as i,Y as P,ad as Z,bs as $,bt as m,bZ as _,c0 as O,c1 as R,$ as G,j as t,bV as H,V as Y,a_ as D,B as g,v as j,a9 as h}from"./index-W2AL0DnC.js";import{I as c}from"./index-zLdjp0Tq.js";const Q=({isNewAddress:y})=>{const{data:x,refetch:A,isFetching:v}=V(!y),{updateDefaultAddress:S}=i.useContext(P),{addressId:d}=Z(),e=x==null?void 0:x.data.userAddresses.find(a=>a.id===d),o=i.useMemo(()=>({city:(e==null?void 0:e.city)||"",state:(e==null?void 0:e.state)||"",country:(e==null?void 0:e.country)||"USA",zipCode:(e==null?void 0:e.zipCode)||"",placeId:(e==null?void 0:e.id)||"",streetName:(e==null?void 0:e.streetName)||"",isDefaultAddress:(e==null?void 0:e.isDefaultAddress)||!1,apartmentNumber:(e==null?void 0:e.apartmentNumber)||"",firstName:(e==null?void 0:e.firstName)||"",lastName:(e==null?void 0:e.lastName)||"",email:(e==null?void 0:e.email)||"",phoneNumber:(e==null?void 0:e.phoneNumber)||""}),[e]),w=$().shape({streetName:m().required("Address Line 1 is required"),state:m().required("State is required"),city:m().required("City is required"),zipCode:m().required("Zip Code is required").matches(/^[0-9]+$/,"Must be only digits").min(5,"Must be exactly 5 digits").max(5,"Must be exactly 5 digits"),placeId:m()}),I=localStorage.getItem("isPvrpleAuthenticated"),[N,z]=i.useState({}),[L,C]=i.useState(o),{data:s,isLoading:M}=_(N.locationId),q=O(),k=R(),p=G();I||p("/"),i.useEffect(()=>{s&&!M&&(s.data?C(a=>{var r,l,n;return{...a,zipCode:((r=s==null?void 0:s.data)==null?void 0:r.zipCode)||"",state:((l=s==null?void 0:s.data)==null?void 0:l.state)||"",city:((n=s==null?void 0:s.data)==null?void 0:n.city)||"",streetName:(s==null?void 0:s.data.label.split(",")[0])||"",apartmentNumber:"",country:"USA",placeId:N.locationId||""}}):C(a=>({...a,streetName:N.location,apartmentNumber:"",city:"",state:"",zipCode:"",placeId:""})))},[s]),i.useEffect(()=>{C(o)},[o]);const B=a=>{z(()=>a)},F=(a,r)=>{y?k.mutateAsync(a).then(()=>{A(),p(j.address_book),h.success("Successfully added",{toastId:1,type:"success"})}).catch(l=>{r(),h.error(l.response.data.Error.Message,{toastId:2,type:"error"})}):q.mutateAsync({address:a,id:d}).then(()=>{A(),p(j.address_book),d&&S(d,{...a,id:d}),h.success("Successfully updated",{toastId:1,type:"success"})}).catch(l=>{r(),h.error(l.response.data.Error.Message,{toastId:2,type:"error"})})},U=()=>{p(-1)};return t.jsx(H,{className:"px-20 md:px-0",title:y?"Add Address":"Edit Address",children:v?t.jsx("div",{className:"m-28",children:t.jsx(Y,{size:45})}):t.jsx(D,{initialValues:L||o,onSubmit:(a,{resetForm:r})=>{F(a,r)},enableReinitialize:!0,validationSchema:w,validateOnChange:!1,validateOnBlur:!0,children:a=>{const{handleChange:r,handleSubmit:l,setFieldValue:n,values:u,errors:f,touched:b}=a;return t.jsxs("div",{children:[t.jsx(c,{type:"autocomplete",id:"streetName",name:"streetName",value:u.streetName,setFieldValue:n,setSelected:B,handleChange:r,placeholder:"Address Line 1* ",label:"Address Line 1",labelClass:"text-black text-base mb-2",error:f.streetName,isTouched:b.streetName}),t.jsx(c,{id:"apartmentNumber",name:"apartmentNumber",value:u.apartmentNumber,setFieldValue:n,handleChange:r,className:"mt-5",placeholder:"Address Line 2 ",label:"Address Line 2"}),t.jsxs("div",{className:"my-5 flex flex-row justify-between",children:[t.jsx(c,{id:"city",placeholder:"City*",name:"city",className:"mb-0 w-1/2 pr-5",fieldClass:"w-full",label:"City",handleChange:r,error:f.city,isTouched:b.city}),t.jsx(c,{id:"state",className:"mb-0 w-1/2 ",fieldClass:"w-full",placeholder:"State*",label:"State",name:"state",value:u.state,handleChange:r,error:f.state,isTouched:b.state})]}),t.jsxs("div",{className:"my-5 flex flex-row justify-between",children:[t.jsx(c,{className:"mb-0 w-1/2 pr-5",fieldClass:"w-full",label:"Zip Code",id:"zipCode",name:"zipCode",handleChange:r,placeholder:"Zip Code*",value:u.zipCode,error:f.zipCode,isTouched:b.zipCode}),t.jsx(c,{id:"shippingAddress.country",placeholder:"Country",name:"country",label:"Country",className:"mb-0 w-1/2",value:u.country,disabled:!0,fieldClass:"opacity-50",handleChange:r})]}),t.jsxs("div",{className:"mt-10 flex flex-row justify-end gap-5 md:flex-col-reverse md:space-y-2 sm:gap-2",children:[t.jsx(g,{className:"w-fit max-w-40 md:max-w-full",colorTheme:"purple",type:"button",variant:"outline",onClick:U,children:"Dismiss"}),t.jsx(g,{className:"w-fit max-w-40 md:max-w-full",colorTheme:"green",type:"submit",variant:"filled",onClick:l,children:"Submit"})]})]})}})})};export{Q as EditAddress,Q as default};
