import{bs as C,bt as f,r as l,b as E,c as I,Y as A,l as F,bA as U,j as e,a_ as k,a$ as G,bB as b,bC as g,V as L,L as M,bD as T,bE as w,bF as i,bG as V,bH as $}from"./index-W2AL0DnC.js";import{G as q}from"./index-D10kJhc4.js";const z=C().shape({email:f().email("Invalid email").required("Please fill in your email"),password:f().required("Please fill in your password")}),H=()=>{const[o,j]=l.useState(!1),[n,c]=l.useState(""),[d,m]=l.useState(!1),[s,a]=E(),{refetch:S}=I(),{setUser:y}=l.useContext(A),{refetchCarts:x}=F(),{refetch:P}=U(),N=()=>{j(!o)},v=async r=>{var u,h;m(!0);try{await T.signIn(r.email,r.password);const t=await S();if((u=t.data)!=null&&u.isSuccess){await P(),x(),w(),s.delete("auth"),s.get("email")&&s.delete("email"),a(s),localStorage.setItem("isPvrpleAuthenticated",r.email),(h=t.data)!=null&&h.data?(y(t.data.data),setTimeout(()=>{t.data.data&&(x(),s.set(i.Auth,"profile"))},200)):(s.set("auth","profile"),a(s));const p=s.get(i.ExternalPortalUrl);p!==null&&(V(p),s.delete(i.ExternalPortalUrl)),s.set(i.Auth,$.Profile),a(s)}else c("Error fetching user profile")}catch(t){t.code==="UserNotConfirmedException"&&(s.set("auth","verifyemail"),s.set("email",r.email),a(s)),w(),c(t.message)}finally{m(!1)}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative pb-4",children:[e.jsx("h1",{className:"mb-6 text-4xl font-bold text-purple-500",children:"Sign in"}),e.jsx(q,{}),e.jsx(k,{initialValues:{email:s.get("email")??"",password:""},validationSchema:z,onSubmit:v,children:e.jsxs(G,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(b,{className:"w-full rounded-lg border border-white-500 px-3 py-4 text-sm",type:"email",name:"email",placeholder:"Email"}),e.jsx(g,{name:"email",component:"div",className:"mt-1 px-2 text-sm text-red-500"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"w-full rounded-lg border border-white-500 px-3 py-4 text-sm",type:o?"text":"password",name:"password",placeholder:"Password"}),e.jsx("button",{type:"button",className:"absolute  right-3 top-1/2 -translate-y-1/2 transform text-sm text-purple-500",onClick:N,children:o?"Hide":"Show"})]}),e.jsx(g,{name:"password",component:"div",className:"mt-1 px-2 text-sm text-red-500"})]}),n&&e.jsx("div",{className:"mt-1 text-sm text-red-500",children:n}),d&&e.jsx("div",{className:"bg-white absolute inset-0 z-50 flex items-center justify-center bg-white-500 bg-opacity-50",children:e.jsx(L,{size:40})}),e.jsx(M,{to:"?auth=forgotpassword",children:e.jsx("button",{className:"text-sm text-green-500 underline hover:text-green-600",type:"button",children:"Forgot password?"})}),e.jsx("button",{className:"my-4 w-full rounded-lg bg-purple-500 py-4 text-sm font-bold text-white-500 hover:bg-purple-600",type:"submit",disabled:d,children:"Sign in"})]})}),e.jsxs("div",{className:" flex w-full justify-center text-sm",children:[e.jsx("span",{className:"pr-1 text-center",children:"Don't have an account? "}),e.jsx("button",{onClick:()=>{s.set("auth","signup"),a(s)},className:" font-bold text-green-500 underline hover:text-green-600",children:"Sign up here"})]})]})})};export{H as default};
